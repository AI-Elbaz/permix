---
title: Hono
description: Learn how to use Permix with Hono
---

## Overview

Permix provides middleware for Hono that allows you to easily check permissions in your routes. The middleware can be created using the `createPermixHono` function.

<Callout>
Before getting started with Hono integration, make sure you've completed the initial setup steps in the [Quick Start](/docs/quick-start) guide.
</Callout>

<Steps>

<Step>

## Setup

Here's a basic example of how to use the Permix middleware with Hono:

```ts twoslash
import { Hono } from 'hono'
import { createPermixHono } from 'permix/hono'

interface Post {
  id: string
  authorId: string
  title: string
  content: string
}

// Initialize Hono
const app = new Hono()

// Create your Permix instance
const permixHono = createPermixHono<{
  post: {
    dataType: Post
    action: 'create' | 'read' | 'update'
  }
}>()

// Set up the middleware with your permission rules
app.use('*', permixHono.setupMiddleware(({ c }) => {
  // You can access c.get('user') or other properties to determine permissions
  return {
    post: {
      create: true, // Allow post creation
      read: true,   // Allow post reading
      update: false // Disallow post updates
    }
  }
}))
```

<Callout>
The middleware preserves full type safety from your Permix definition, ensuring your permission checks are type-safe.
</Callout>

</Step>

<Step>

## Usage

Use the `checkMiddleware` function in your Hono routes to check permissions:

```ts
app.post('/posts', permixHono.checkMiddleware('post', 'create'), (c) => {
  // Only executes if user has 'create' permission for 'post'
  return c.json({ success: true })
})

// Check multiple actions
app.put('/posts/:id', permixHono.checkMiddleware('post', ['read', 'update']), (c) => {
  // Only executes if user has both 'read' and 'update' permissions
  return c.json({ success: true })
})

// Check all actions
app.delete('/posts/:id', permixHono.checkMiddleware('post', 'all'), (c) => {
  // Only executes if user has all permissions for 'post'
  return c.json({ success: true })
})
```

</Step>

<Step>

## Accessing Permix in Route Handlers

You can access the Permix instance directly in your route handlers using the `get` function:

```ts
app.get('/posts', (c) => {
  const permix = permixHono.get(c)

  // Check permissions manually
  if (permix.check('post', 'read')) {
    // User has permission to read posts
    return c.json({ posts: getAllPosts() })
  } else {
    return c.json({ error: 'You do not have permission to read posts' }, 403)
  }
})
```

</Step>

</Steps>

## Custom Error Handling

By default, the middleware returns a 403 Forbidden response. You can customize this behavior by providing an `onUnauthorized` handler:

### Basic Error Handler

```ts
const permixHono = createPermixHono<Definition>({
  onUnauthorized: ({ c }) => {
    return c.json({ error: 'Custom unauthorized message' }, 403)
  }
})
```

### Dynamic Error Handler

You can also provide a handler that returns different responses based on the entity and actions:

```ts
const permixHono = createPermixHono<Definition>({
  onUnauthorized: ({ c, entity, actions }) => {
    if (entity === 'post' && actions.includes('create')) {
      return c.json({
        error: `You don't have permission to ${actions.join('/')} a ${entity}`
      }, 403)
    }

    return c.json({
      error: 'You do not have permission to perform this action'
    }, 401)
  }
})
```

The `onUnauthorized` handler receives:
- `c`: Hono Context object
- `entity`: The entity that was checked
- `actions`: Array of actions that were checked
